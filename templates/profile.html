
{% extends 'base.html' %}

{% block title %}Профіль{% endblock %}

{% block body %}
<h1 class="mb-4">Налаштування профілю</h1>

<div class="profile-settings-card">
  <form class="profile-right" method="post" enctype="multipart/form-data">

    <div class="profile-left">
      <div class="avatar-circle">
        <img id="avatarPreview"
             src="{% if user.avatar %}
                      {{ url_for('static', filename='img/avatars/' ~ user.avatar) }}
                    {% else %}
                      {{ url_for('static', filename='img/avatar.png') }}
                    {% endif %}"
             alt="Аватар">
      </div>

      <label class="btn btn-sm btn-outline-secondary mt-2">
        Обрати новий аватар
        <input type="file" id="avatarInput" name="avatar" accept="image/*" hidden>
      </label>
    </div>

    <div class="profile-fields-box">
      <h2 class="profile-box-title">Основна інформація</h2>

      <div class="mb-3">
        <label for="username" class="form-label">Ім'я користувача</label>
        <input type="text" class="form-control" id="username" name="username"
               value="{{ user.username if user else '' }}" required>
      </div>

      <div class="mb-3">
        <label for="email" class="form-label">Електронна пошта</label>
        <input type="email" class="form-control" id="email" name="email"
               value="{{ user.email if user and user.email else '' }}">
      </div>

      <div class="mb-3">
        <label for="about" class="form-label">Про себе</label>
        <textarea class="form-control" id="about" name="about" rows="3"
                  placeholder="Кілька слів про себе...">{{ user.about if user and user.about else '' }}</textarea>
      </div>
    </div>

    <div class="profile-genres-box">
      <h2 class="profile-box-title">Улюблені жанри</h2>
      <div class="genre-pills">
        {% set all_genres = ['Хоррор', 'Драма', 'Комедія', 'Фантастика', 'Мелодрама', 'Бойовик'] %}
        {% set selected = (user.genres.split(',') if user and user.genres else []) %}
        {% for g in all_genres %}
          {% set gid = 'genre_' ~ loop.index %}
          <input type="checkbox"
                 class="genre-pill-input"
                 id="{{ gid }}"
                 name="genres"
                 value="{{ g }}"
                 {% if g in selected %}checked{% endif %}>
          <label class="genre-pill" for="{{ gid }}">{{ g }}</label>
        {% endfor %}
      </div>
    </div>

    <div class="mt-3">
      <button type="submit" class="btn btn-primary">Зберегти зміни</button>
    </div>

  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const input = document.getElementById('avatarInput');
  const img   = document.getElementById('avatarPreview');

  if (!input || !img) return;

  input.addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (ev) {
      img.src = ev.target.result;
    };
    reader.readAsDataURL(file);
  });
});
</script>
{% endblock %}